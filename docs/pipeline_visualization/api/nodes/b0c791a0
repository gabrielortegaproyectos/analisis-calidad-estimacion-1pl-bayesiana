{
  "code": "def summarize_bayes_estimation(\n    difficulties: pd.DataFrame,\n    **estimates: pd.DataFrame,\n) -> pd.DataFrame:\n    true_df = difficulties.sort_values(\"item_id\").reset_index(drop=True)\n\n    rows: list[dict] = []\n    for key, est_df in sorted(estimates.items()):\n        # key formato: est_p_0_3_r_0_7\n        try:\n            tmp = key.split(\"est_p_\")[-1]\n            p_str, r_str = tmp.split(\"_r_\")\n            percent = float(p_str.replace(\"_\", \".\"))\n            r_level = float(r_str.replace(\"_\", \".\"))\n        except Exception:\n            percent = float(\"nan\")\n            r_level = float(\"nan\")\n\n        est_df = est_df.sort_values(\"item_id\").reset_index(drop=True)\n        merged = pd.merge(true_df, est_df, on=\"item_id\", how=\"inner\")\n        y_true = merged[\"difficulty\"].to_numpy(dtype=float)\n        y_hat = merged[\"est_bayes_difficulty\"].to_numpy(dtype=float)\n\n        if y_true.size < 2 or np.all(~np.isfinite(y_hat)):\n            r = np.nan\n            r2 = np.nan\n            mse = np.nan\n            mae = np.nan\n            bias = np.nan\n        else:\n            r = float(np.corrcoef(y_true, y_hat)[0, 1])\n            r2 = r * r\n            err = y_hat - y_true\n            mse = float(np.mean(err ** 2))\n            mae = float(np.mean(np.abs(err)))\n            bias = float(np.mean(err))\n\n        rows.append({\n            \"dataset_key\": key,\n            \"percent\": percent,\n            \"r_level\": r_level,\n            \"r\": r,\n            \"r2\": r2,\n            \"mse\": mse,\n            \"mae\": mae,\n            \"bias\": bias,\n            \"n_items\": int(y_true.size),\n        })\n\n    return pd.DataFrame(rows).sort_values([\"percent\", \"r_level\"]).reset_index(drop=True)\n",
  "filepath": "analisis-calidad-estimacion-1pl-bayesiana/src/analisis_calidad_estimacion_1pl_bayesiana/pipelines/bayes_estimation_s1/nodes.py",
  "parameters": {},
  "run_command": "kedro run --to-nodes='bayes_estimation__s1.s1_bayes_estimation_summary'",
  "inputs": [
    "sample__s1.difficulties",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_1_r_0_1",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_1_r_0_2",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_1_r_0_3",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_1_r_0_4",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_1_r_0_5",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_1_r_0_6",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_1_r_0_7",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_1_r_0_8",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_1_r_0_9",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_1_r_1_0",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_2_r_0_1",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_2_r_0_2",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_2_r_0_3",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_2_r_0_4",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_2_r_0_5",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_2_r_0_6",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_2_r_0_7",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_2_r_0_8",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_2_r_0_9",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_2_r_1_0",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_3_r_0_1",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_3_r_0_2",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_3_r_0_3",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_3_r_0_4",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_3_r_0_5",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_3_r_0_6",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_3_r_0_7",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_3_r_0_8",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_3_r_0_9",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_3_r_1_0",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_4_r_0_1",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_4_r_0_2",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_4_r_0_3",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_4_r_0_4",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_4_r_0_5",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_4_r_0_6",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_4_r_0_7",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_4_r_0_8",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_4_r_0_9",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_4_r_1_0",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_5_r_0_1",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_5_r_0_2",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_5_r_0_3",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_5_r_0_4",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_5_r_0_5",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_5_r_0_6",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_5_r_0_7",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_5_r_0_8",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_5_r_0_9",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_5_r_1_0",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_6_r_0_1",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_6_r_0_2",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_6_r_0_3",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_6_r_0_4",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_6_r_0_5",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_6_r_0_6",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_6_r_0_7",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_6_r_0_8",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_6_r_0_9",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_6_r_1_0",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_7_r_0_1",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_7_r_0_2",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_7_r_0_3",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_7_r_0_4",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_7_r_0_5",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_7_r_0_6",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_7_r_0_7",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_7_r_0_8",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_7_r_0_9",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_7_r_1_0",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_8_r_0_1",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_8_r_0_2",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_8_r_0_3",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_8_r_0_4",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_8_r_0_5",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_8_r_0_6",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_8_r_0_7",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_8_r_0_8",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_8_r_0_9",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_8_r_1_0",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_9_r_0_1",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_9_r_0_2",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_9_r_0_3",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_9_r_0_4",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_9_r_0_5",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_9_r_0_6",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_9_r_0_7",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_9_r_0_8",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_9_r_0_9",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_0_9_r_1_0",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_1_0_r_0_1",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_1_0_r_0_2",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_1_0_r_0_3",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_1_0_r_0_4",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_1_0_r_0_5",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_1_0_r_0_6",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_1_0_r_0_7",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_1_0_r_0_8",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_1_0_r_0_9",
    "bayes_estimation__s1.bayes_estimation_difficulty_p_1_0_r_1_0"
  ],
  "outputs": [
    "bayes_estimation__s1.bayes_estimation_summary"
  ]
}